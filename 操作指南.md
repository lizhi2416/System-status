# 监控操作指南

本文档说明如何启动和停止 Apple Developer System Status 监控服务。

## 📋 前置条件

1. 确保已安装 Python 3.x
2. 确保已安装项目依赖（如果未安装，先执行 `pip install -r requirements.txt`）
3. 确保已配置 `config.py` 文件（邮件配置等）

## 🚀 启动监控

### 方法一：使用虚拟环境启动（推荐）

```bash
# 1. 进入项目目录
cd /Users/by/Desktop/System-status

# 2. 激活虚拟环境
source venv/bin/activate

# 3. 启动监控（后台运行）
nohup python monitor.py > monitor.out 2>&1 &
```

### 方法二：直接启动（不使用虚拟环境）

```bash
# 1. 进入项目目录
cd /Users/by/Desktop/System-status

# 2. 启动监控（后台运行）
nohup python3 monitor.py > monitor.out 2>&1 &
```

### 方法三：前台运行（用于调试）

```bash
# 1. 进入项目目录
cd /Users/by/Desktop/System-status

# 2. 激活虚拟环境（如果使用）
source venv/bin/activate

# 3. 前台运行（按 Ctrl+C 可停止）
python monitor.py
```

## 🛑 停止监控

### 方法一：查找并停止进程（推荐）

```bash
# 1. 查找监控进程
ps aux | grep monitor.py | grep -v grep

# 2. 停止进程（使用进程ID）
kill <进程ID>

# 或者直接使用命令停止所有监控进程
pkill -f monitor.py
```

### 方法二：强制停止（如果方法一无效）

```bash
# 强制停止所有监控进程
pkill -9 -f monitor.py
```

### 方法三：如果在前台运行

直接按 `Ctrl + C` 即可停止。

## ✅ 验证监控状态

### 检查监控是否在运行

```bash
# 查看是否有监控进程
ps aux | grep monitor.py | grep -v grep
```

如果有输出，说明监控正在运行；如果没有输出，说明监控已停止。

### 查看实时日志

```bash
# 查看最新的日志（最后50行）
tail -50 logs/monitor_*.log

# 实时跟踪日志（按 Ctrl+C 退出）
tail -f logs/monitor_*.log
```

### 查看输出文件

```bash
# 查看监控输出
tail -50 monitor.out
```

## 📝 完整操作示例

### 启动监控的完整流程

```bash
# 1. 进入项目目录
cd /Users/by/Desktop/System-status

# 2. 激活虚拟环境
source venv/bin/activate

# 3. 启动监控（后台运行）
nohup python monitor.py > monitor.out 2>&1 &

# 4. 验证是否启动成功
ps aux | grep monitor.py | grep -v grep

# 5. 查看日志确认运行正常
tail -20 logs/monitor_*.log
```

### 停止监控的完整流程

```bash
# 1. 查找监控进程
ps aux | grep monitor.py | grep -v grep

# 2. 停止监控进程
pkill -f monitor.py

# 3. 验证是否已停止
ps aux | grep monitor.py | grep -v grep

# 4. 查看最后的日志
tail -20 logs/monitor_*.log
```

## 🔄 重启监控

如果需要重启监控，先停止再启动：

```bash
# 1. 停止监控
pkill -f monitor.py

# 2. 等待2秒
sleep 2

# 3. 启动监控
cd /Users/by/Desktop/System-status
source venv/bin/activate
nohup python monitor.py > monitor.out 2>&1 &

# 4. 验证启动成功
ps aux | grep monitor.py | grep -v grep
```

## 📊 监控配置说明

监控的检测间隔等配置在 `config.py` 文件中：

- `CHECK_INTERVAL`: 检测间隔（秒），默认 60 秒（1分钟）
- `RETRY_COUNT`: 请求失败重试次数，默认 3 次
- `RETRY_DELAY`: 重试间隔（秒），默认 5 秒

修改配置后需要重启监控才能生效。

## ⚠️ 注意事项

1. **后台运行**：使用 `nohup` 和 `&` 可以让监控在后台运行，即使关闭终端也不会停止
2. **日志文件**：日志文件保存在 `logs/` 目录，按日期命名（如 `monitor_20251122.log`）
3. **输出文件**：使用 `nohup` 时，标准输出会重定向到 `monitor.out` 文件
4. **多个进程**：如果发现多个监控进程在运行，建议全部停止后重新启动一个
5. **资源占用**：监控程序占用资源很少，可以长期运行

## 🆘 常见问题

### Q: 如何确认监控是否正常运行？

A: 执行以下命令：
```bash
# 检查进程
ps aux | grep monitor.py | grep -v grep

# 查看最新日志
tail -30 logs/monitor_*.log
```

如果进程存在且日志中有最新的检测记录，说明正常运行。

### Q: 停止监控后如何确认已完全停止？

A: 执行以下命令，如果没有输出则说明已停止：
```bash
ps aux | grep monitor.py | grep -v grep
```

### Q: 监控启动失败怎么办？

A: 
1. 检查 Python 环境是否正确
2. 检查依赖是否安装：`pip list | grep requests`
3. 查看错误信息：`cat monitor.out`
4. 检查配置文件：确保 `config.py` 配置正确

### Q: 如何修改检测间隔？

A: 编辑 `config.py` 文件，修改 `CHECK_INTERVAL` 的值（单位：秒），然后重启监控。

## 📞 获取帮助

如果遇到问题，可以：
1. 查看日志文件：`logs/monitor_*.log`
2. 查看输出文件：`monitor.out`
3. 检查配置文件：`config.py`

